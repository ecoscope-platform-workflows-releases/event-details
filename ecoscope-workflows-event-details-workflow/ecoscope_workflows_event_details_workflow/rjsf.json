{
  "properties": {
    "workflow_details": {
      "additionalProperties": false,
      "properties": {
        "name": {
          "title": "Workflow Name",
          "type": "string"
        },
        "description": {
          "default": "",
          "title": "Workflow Description",
          "type": "string"
        }
      },
      "required": [
        "name"
      ],
      "type": "object",
      "description": "Add information that will help to differentiate this workflow from another.",
      "title": "Workflow Details"
    },
    "er_client_name": {
      "additionalProperties": false,
      "properties": {
        "data_source": {
          "$ref": "#/$defs/EarthRangerConnection",
          "title": "",
          "description": "Select one of your configured data sources."
        }
      },
      "required": [
        "data_source"
      ],
      "type": "object",
      "title": "Data Source"
    },
    "time_range": {
      "additionalProperties": false,
      "properties": {
        "since": {
          "format": "date-time",
          "title": "Since",
          "type": "string",
          "description": "The start time"
        },
        "until": {
          "format": "date-time",
          "title": "Until",
          "type": "string",
          "description": "The end time"
        },
        "timezone": {
          "allOf": [
            {
              "$ref": "#/$defs/TimezoneInfo"
            }
          ],
          "default": null,
          "title": "Timezone"
        }
      },
      "required": [
        "since",
        "until"
      ],
      "type": "object",
      "description": "Choose the period of time to analyze.",
      "title": "Time Range"
    },
    "set_event_details_combined": {
      "additionalProperties": false,
      "properties": {
        "event_type": {
          "title": "Events Type",
          "type": "string",
          "ecoscope:event_type_schema_properties": "properties.er_client_name.properties.data_source.properties.name"
        },
        "analysis_field": {
          "title": "Analysis Field - Numeric field to analyze",
          "type": "string",
          "description": "Select the numeric field the work will use for calculations, i.e. the sum of the field from all events in the workflow.",
          "ecoscope:event_type_schema_numeric_prop": "properties.set_event_details_combined.properties.event_type"
        },
        "analysis_field_label": {
          "title": "Label for analysis data",
          "type": "string",
          "description": "The provided text will be used to label the analysis data in the outputs."
        },
        "analysis_field_unit": {
          "title": "Units - What does the number represent?",
          "type": "string",
          "description": "Describe the unit or entity for the number,e.g., \"elephants\", \"meters\", \"snares\", \"$USD.\""
        },
        "category_field": {
          "default": "",
          "title": "Category Field - Choice field to categorize by",
          "type": "string",
          "description": "Differentiate events with the choices in a choice field. Each choice will be represented by a different color in the outputs.",
          "ecoscope:event_type_schema_choice_prop": "properties.set_event_details_combined.properties.event_type"
        },
        "category_field_label": {
          "default": "",
          "title": "Label for category data",
          "type": "string",
          "description": "The provided text will be used to label the category data in the outputs."
        },
        "include_null_geometry": {
          "default": true,
          "title": "Include Events Without a Geometry (point or polygon)",
          "type": "boolean"
        }
      },
      "required": [
        "event_type",
        "analysis_field",
        "analysis_field_label",
        "analysis_field_unit"
      ],
      "type": "object",
      "title": "Event Types"
    },
    "groupers": {
      "additionalProperties": false,
      "properties": {
        "groupers": {
          "default": null,
          "items": {
            "anyOf": [
              {
                "$ref": "#/$defs/ValueGrouper"
              },
              {
                "$ref": "#/$defs/TemporalGrouper"
              },
              {
                "$ref": "#/$defs/SpatialGrouper"
              }
            ],
            "title": "Group by"
          },
          "title": " ",
          "type": "array",
          "description": "            Specify how the data should be grouped to create the views for your dashboard.\n            This field is optional; if left blank, all the data will appear in a single view.\n            ",
          "ecoscope:spatial_feature_group": "properties.er_client_name.properties.data_source.properties.name",
          "ecoscope:event_type_schema_choice_prop": "properties.set_event_details_combined.properties.event_type"
        }
      },
      "type": "object",
      "required": [],
      "title": "Group Data"
    },
    "filter_events": {
      "additionalProperties": false,
      "properties": {
        "bounding_box": {
          "allOf": [
            {
              "$ref": "#/$defs/BoundingBox"
            }
          ],
          "default": {
            "min_y": -90.0,
            "max_y": 90.0,
            "min_x": -180.0,
            "max_x": 180.0
          },
          "title": "Bounding Box",
          "description": "Filter events to inside these bounding coordinates.",
          "ecoscope:advanced": true
        },
        "filter_point_coords": {
          "default": [],
          "items": {
            "$ref": "#/$defs/Coordinate"
          },
          "title": "Filter Exact Point Coordinates",
          "type": "array",
          "description": "By adding a filter, the workflow will not include events recorded at the specified coordinates.",
          "ecoscope:advanced": true
        }
      },
      "required": [],
      "type": "object",
      "title": "Event Location Filter"
    },
    "base_map_defs": {
      "additionalProperties": false,
      "properties": {
        "base_maps": {
          "default": [
            {
              "url": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",
              "opacity": 1
            },
            {
              "url": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
              "opacity": 0.5
            }
          ],
          "items": {
            "title": "Base Layer",
            "anyOf": [
              {
                "properties": {
                  "url": {
                    "default": "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
                    "title": "Preset Layer URL",
                    "type": "string",
                    "const": "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
                    "enum": [
                      "https://tile.openstreetmap.org/{z}/{x}/{y}.png"
                    ]
                  },
                  "opacity": {
                    "default": 1,
                    "description": "Set layer transparency from 1 (fully visible) to 0 (hidden).",
                    "ecoscope:advanced": true,
                    "maximum": 1.0,
                    "minimum": 0.0,
                    "title": "Layer Opacity",
                    "type": "number"
                  }
                },
                "title": "Open Street Map",
                "type": "object"
              },
              {
                "properties": {
                  "url": {
                    "default": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",
                    "title": "Preset Layer URL",
                    "type": "string",
                    "const": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",
                    "enum": [
                      "https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}"
                    ]
                  },
                  "opacity": {
                    "default": 1,
                    "description": "Set layer transparency from 1 (fully visible) to 0 (hidden).",
                    "ecoscope:advanced": true,
                    "maximum": 1.0,
                    "minimum": 0.0,
                    "title": "Layer Opacity",
                    "type": "number"
                  }
                },
                "title": "Roadmap",
                "type": "object"
              },
              {
                "properties": {
                  "url": {
                    "default": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
                    "title": "Preset Layer URL",
                    "type": "string",
                    "const": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
                    "enum": [
                      "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"
                    ]
                  },
                  "opacity": {
                    "default": 1,
                    "description": "Set layer transparency from 1 (fully visible) to 0 (hidden).",
                    "ecoscope:advanced": true,
                    "maximum": 1.0,
                    "minimum": 0.0,
                    "title": "Layer Opacity",
                    "type": "number"
                  }
                },
                "title": "Satellite",
                "type": "object"
              },
              {
                "properties": {
                  "url": {
                    "default": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",
                    "title": "Preset Layer URL",
                    "type": "string",
                    "const": "https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",
                    "enum": [
                      "https://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}"
                    ]
                  },
                  "opacity": {
                    "default": 1,
                    "description": "Set layer transparency from 1 (fully visible) to 0 (hidden).",
                    "ecoscope:advanced": true,
                    "maximum": 1.0,
                    "minimum": 0.0,
                    "title": "Layer Opacity",
                    "type": "number"
                  }
                },
                "title": "Terrain",
                "type": "object"
              },
              {
                "properties": {
                  "url": {
                    "default": "https://tiles.arcgis.com/tiles/POUcpLYXNckpLjnY/arcgis/rest/services/landDx_basemap_tiles_mapservice/MapServer/tile/{z}/{y}/{x}",
                    "title": "Preset Layer URL",
                    "type": "string",
                    "const": "https://tiles.arcgis.com/tiles/POUcpLYXNckpLjnY/arcgis/rest/services/landDx_basemap_tiles_mapservice/MapServer/tile/{z}/{y}/{x}",
                    "enum": [
                      "https://tiles.arcgis.com/tiles/POUcpLYXNckpLjnY/arcgis/rest/services/landDx_basemap_tiles_mapservice/MapServer/tile/{z}/{y}/{x}"
                    ]
                  },
                  "opacity": {
                    "default": 1,
                    "description": "Set layer transparency from 1 (fully visible) to 0 (hidden).",
                    "ecoscope:advanced": true,
                    "maximum": 1.0,
                    "minimum": 0.0,
                    "title": "Layer Opacity",
                    "type": "number"
                  }
                },
                "title": "LandDx",
                "type": "object"
              },
              {
                "properties": {
                  "url": {
                    "default": "https://server.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer/tile/{z}/{y}/{x}",
                    "title": "Preset Layer URL",
                    "type": "string",
                    "const": "https://server.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer/tile/{z}/{y}/{x}",
                    "enum": [
                      "https://server.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer/tile/{z}/{y}/{x}"
                    ]
                  },
                  "opacity": {
                    "default": 1,
                    "description": "Set layer transparency from 1 (fully visible) to 0 (hidden).",
                    "ecoscope:advanced": true,
                    "maximum": 1.0,
                    "minimum": 0.0,
                    "title": "Layer Opacity",
                    "type": "number"
                  }
                },
                "title": "USGS Hillshade",
                "type": "object"
              },
              {
                "properties": {
                  "url": {
                    "default": "https://example.tiles.com/{z}/{x}/{y}.png",
                    "description": "The URL of a publicly accessible tiled raster service.",
                    "pattern": "https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}([-a-zA-Z0-9()@:%_\\+.~#?&//=\\{\\}]*)",
                    "title": "Custom Layer URL",
                    "type": "string"
                  },
                  "opacity": {
                    "default": 1,
                    "description": "Set layer transparency from 1 (fully visible) to 0 (hidden).",
                    "ecoscope:advanced": true,
                    "maximum": 1.0,
                    "minimum": 0.0,
                    "title": "Custom Layer Opacity",
                    "type": "number"
                  },
                  "max_zoom": {
                    "default": null,
                    "description": "Set the maximum zoom level to fetch tiles for.",
                    "title": "Custom Layer Max Zoom",
                    "type": "integer"
                  },
                  "min_zoom": {
                    "default": null,
                    "description": "Set the minimum zoom level to fetch tiles for.",
                    "title": "Custom Layer Min Zoom",
                    "type": "integer"
                  }
                },
                "title": "Custom Layer (Advanced)",
                "type": "object"
              }
            ]
          },
          "title": " ",
          "type": "array",
          "description": "Select tile layers to use as base layers in map outputs. The first layer in the list will be the bottommost layer displayed.",
          "ecoscope:advanced": true
        }
      },
      "type": "object",
      "required": [],
      "title": "Map Base Layers"
    },
    "Events Bar Chart": {
      "type": "object",
      "description": "The bar chart shows how many events of different types occurred over time. Choose the time interval for the x-axis to control how event counts are summarized over time.",
      "ecoscope:task_group": true,
      "properties": {
        "events_bar_chart": {
          "additionalProperties": false,
          "properties": {
            "time_interval": {
              "enum": [
                "year",
                "month",
                "week",
                "day",
                "hour"
              ],
              "title": "Time Interval",
              "type": "string"
            }
          },
          "required": [
            "time_interval"
          ],
          "type": "object",
          "title": ""
        }
      }
    },
    "Analysis Field Sum Map": {
      "type": "object",
      "description": "These settings generate a grid-based heatmap showing where events are concentrated.",
      "ecoscope:task_group": true,
      "properties": {
        "events_meshgrid": {
          "additionalProperties": false,
          "properties": {
            "auto_scale_or_custom_cell_size": {
              "anyOf": [
                {
                  "$ref": "#/$defs/AutoScaleGridCellSize"
                },
                {
                  "$ref": "#/$defs/CustomGridCellSize"
                }
              ],
              "default": {
                "auto_scale_or_custom": "Auto-scale"
              },
              "title": "Grid Cell Size",
              "ecoscope:advanced": true
            },
            "crs": {
              "default": "EPSG:3857",
              "title": "Coordinate Reference System",
              "type": "string",
              "description": "The coordinate reference system in which to perform the calculation, must be a valid CRS authority code, for example ESRI:53042",
              "ecoscope:advanced": true
            }
          },
          "required": [],
          "type": "object",
          "title": ""
        }
      }
    }
  },
  "$defs": {
    "EarthRangerConnection": {
      "properties": {
        "name": {
          "title": "Data Source",
          "type": "string"
        }
      },
      "required": [
        "name"
      ],
      "title": "EarthRangerConnection",
      "type": "object"
    },
    "TimezoneInfo": {
      "properties": {
        "label": {
          "title": "Label",
          "type": "string"
        },
        "tzCode": {
          "title": "Tzcode",
          "type": "string"
        },
        "name": {
          "title": "Name",
          "type": "string"
        },
        "utc": {
          "title": "Utc",
          "type": "string"
        }
      },
      "required": [
        "label",
        "tzCode",
        "name",
        "utc"
      ],
      "title": "TimezoneInfo",
      "type": "object"
    },
    "SpatialGrouper": {
      "title": "Spatial Regions",
      "type": "string"
    },
    "TemporalGrouper": {
      "oneOf": [
        {
          "const": "%Y",
          "title": "Year (example: 2024)"
        },
        {
          "const": "%B",
          "title": "Month (example: September)"
        },
        {
          "const": "%Y-%m",
          "title": "Year and Month (example: 2023-01)"
        },
        {
          "const": "%j",
          "title": "Day of the year as a number (example: 365)"
        },
        {
          "const": "%d",
          "title": "Day of the month as a number (example: 31)"
        },
        {
          "const": "%A",
          "title": "Day of the week (example: Sunday)"
        },
        {
          "const": "%H",
          "title": "Hour (24-hour clock) as number (example: 22)"
        },
        {
          "const": "%Y-%m-%d",
          "title": "Date (example: 2025-01-31)"
        }
      ],
      "title": "Time",
      "type": "string"
    },
    "ValueGrouper": {
      "oneOf": [
        {
          "const": "Event Category",
          "title": "Event Type Category"
        },
        {
          "const": "Reported By",
          "title": "Reported By Name"
        }
      ],
      "title": "Category",
      "type": "string"
    },
    "BoundingBox": {
      "properties": {
        "min_y": {
          "default": -90.0,
          "ecoscope:advanced": true,
          "title": "Min Latitude",
          "type": "number"
        },
        "max_y": {
          "default": 90.0,
          "ecoscope:advanced": true,
          "title": "Max Latitude",
          "type": "number"
        },
        "min_x": {
          "default": -180.0,
          "ecoscope:advanced": true,
          "title": "Min Longitude",
          "type": "number"
        },
        "max_x": {
          "default": 180.0,
          "ecoscope:advanced": true,
          "title": "Max Longitude",
          "type": "number"
        }
      },
      "title": "BoundingBox",
      "type": "object"
    },
    "Coordinate": {
      "properties": {
        "y": {
          "description": "Example -0.15293",
          "title": "Latitude",
          "type": "number"
        },
        "x": {
          "description": "Example 37.30906",
          "title": "Longitude",
          "type": "number"
        }
      },
      "required": [
        "y",
        "x"
      ],
      "title": "Coordinate",
      "type": "object"
    },
    "AutoScaleGridCellSize": {
      "properties": {
        "auto_scale_or_custom": {
          "const": "Auto-scale",
          "default": "Auto-scale",
          "ecoscope:advanced": true,
          "enum": [
            "Auto-scale"
          ],
          "title": "Grid Cell Size",
          "type": "string"
        }
      },
      "title": "Auto-scale",
      "type": "object"
    },
    "CustomGridCellSize": {
      "properties": {
        "auto_scale_or_custom": {
          "const": "Customize",
          "default": "Customize",
          "ecoscope:advanced": true,
          "enum": [
            "Customize"
          ],
          "title": "Grid Cell Size",
          "type": "string"
        },
        "grid_cell_size": {
          "default": 5000,
          "description": "Define the resolution of the raster grid (in the unit of measurement defined by the coordinate reference system set below). A smaller grid cell size provides more detail, while a larger size generalizes the data.",
          "exclusiveMaximum": 10000,
          "exclusiveMinimum": 0,
          "gt": 0,
          "lt": 10000,
          "title": "Custom Grid Cell Size",
          "type": "number"
        }
      },
      "title": "Customize",
      "type": "object"
    }
  },
  "uiSchema": {
    "workflow_details": {
      "ui:order": [
        "name",
        "description"
      ]
    },
    "time_range": {
      "ui:order": [
        "since",
        "until",
        "timezone"
      ]
    },
    "set_event_details_combined": {
      "ui:order": [
        "event_type",
        "analysis_field",
        "analysis_field_label",
        "analysis_field_unit",
        "category_field",
        "category_field_label",
        "include_null_geometry"
      ],
      "event_types": {
        "ui:options": {
          "displayLabel": false
        }
      }
    },
    "filter_events": {
      "ui:order": [
        "bounding_box",
        "filter_point_coords"
      ],
      "filter_point_coords": {
        "items": {
          "ui:options": {
            "label": false
          }
        }
      }
    },
    "Analysis Field Sum Map": {
      "events_meshgrid": {
        "ui:order": [
          "auto_scale_or_custom_cell_size",
          "crs"
        ],
        "auto_scale_or_custom_cell_size": {
          "anyOf": [
            {
              "ui:help": "Auto-scale for an optimized grid cell size based the workflow data or Customize to set a specific grid cell size.",
              "ui:options": {
                "label": false
              },
              "auto_scale_or_custom": {
                "ui:widget": "hidden"
              }
            },
            {
              "ui:options": {
                "label": false
              },
              "auto_scale_or_custom": {
                "ui:widget": "hidden"
              }
            }
          ],
          "auto_scale_or_custom": {
            "ui:widget": "hidden"
          }
        }
      }
    },
    "ui:order": [
      "workflow_details",
      "er_client_name",
      "time_range",
      "set_event_details_combined",
      "groupers",
      "filter_events",
      "base_map_defs",
      "Events Bar Chart",
      "Analysis Field Sum Map"
    ],
    "base_map_defs": {
      "base_maps": {
        "items": {
          "ui:options": {
            "label": false
          }
        }
      }
    }
  },
  "additionalProperties": false
}
